# 怪物系统设置说明

本文档说明如何在Unity中设置怪物生成、移动和战斗系统。

---

## 一、设置玩家对象

### 步骤1：给玩家添加 Tag

1. 在 GameScene 中，选中你的角色对象（胶囊体）
2. 在 Inspector 顶部，找到 **Tag** 下拉菜单
3. 如果没有 "Player" Tag：
   - 点击 **Add Tag...**
   - 点击 **+** 按钮
   - 输入 **Player**，保存
4. 回到角色对象，将 Tag 设置为 **Player**

### 步骤2：给玩家添加 Health 组件

1. 选中角色对象
2. 添加组件：`Health`
3. 在 Inspector 中设置：
   - `Max Health`: **100**（可以根据需要调整）

### 步骤3：给玩家添加 PlayerCombatController

1. 选中角色对象
2. 添加组件：`Player Combat Controller`
3. 在角色对象下创建一个空物体，命名为 **FirePoint**
   - 位置：稍微在角色前方（例如 Local Position: X=0, Y=0.5, Z=0.5）
4. 在 Inspector 中配置：
   - `Bullet Prefab`: **暂时留空**（等创建好子弹 Prefab 后再拖入）
   - `Fire Point`: 拖入刚才创建的 **FirePoint** 对象
   - `Attack Range`: **10**
   - `Fire Rate`: **2**（每秒2发）
   - `Damage Per Shot`: **10**

---

## 二、创建怪物 Prefab

### 步骤1：创建怪物对象

1. 在 Hierarchy 中创建一个 **Sphere**（小球），命名为 `Enemy`
2. 调整大小（Scale 可以设为 0.5, 0.5, 0.5，让它比玩家小一点）
3. 设置颜色（可选，例如红色，方便区分）

### 步骤2：给怪物添加组件

1. 选中 `Enemy` 对象
2. 添加组件：
   - `Health`：
     - `Max Health`: **30**（比玩家少，容易打死）
   - `Enemy Controller`：
     - `Move Speed`: **3**
     - `Stopping Distance`: **1.5**
   - `Collider`（Sphere Collider 应该已经有了）：
     - 勾选 **Is Trigger**（用于子弹碰撞检测）
   - （可选）`Rigidbody`：
     - 勾选 **Is Kinematic**（如果使用物理碰撞）

### 步骤3：设置怪物 Tag

1. 选中 `Enemy` 对象
2. 在 Inspector 顶部，将 Tag 设置为 **Enemy**
   - 如果没有 "Enemy" Tag，按照添加 "Player" Tag 的方式添加

### 步骤4：制作 Prefab

1. 在 Project 窗口中，找到 `Assets/EggRogue/Prefabs/` 文件夹（如果没有就创建）
2. 将 Hierarchy 中的 `Enemy` 对象**拖到 Prefabs 文件夹**，创建 Prefab
3. 删除 Hierarchy 中的 `Enemy` 对象（Prefab 已经保存好了）

---

## 三、创建子弹 Prefab

### 步骤1：创建子弹对象

1. 在 Hierarchy 中创建一个 **Capsule**（胶囊体），命名为 `Bullet`
2. 调整大小（Scale 可以设为 0.2, 0.2, 0.2，让它很小）
3. 旋转 90 度（Rotation X = 90），让它横着飞
4. 设置颜色（可选，例如黄色）

### 步骤2：给子弹添加组件

1. 选中 `Bullet` 对象
2. 添加组件：
   - `Projectile`：
     - `Damage`: **10**
     - `Speed`: **15**
     - `Life Time`: **3**
     - `Target Tag`: **Enemy**
   - `Collider`（Capsule Collider 应该已经有了）：
     - 勾选 **Is Trigger**
   - **`Rigidbody`（必加）**：
     - 勾选 **Is Kinematic**
     - 取消 **Use Gravity**
   - Unity 要求：`OnTriggerEnter` 至少一方有 Rigidbody，子弹没有则打不中、不销毁。

### 步骤3：制作 Prefab

1. 将 Hierarchy 中的 `Bullet` 对象**拖到 Prefabs 文件夹**，创建 Prefab
2. 删除 Hierarchy 中的 `Bullet` 对象

---

## 四、设置 EnemyManager

1. 在 GameScene 中创建一个空物体，命名为 **EnemyManager**
2. 添加组件：`Enemy Manager`
3. 不需要在 Inspector 中配置任何东西（单例会自动工作）

---

## 五、设置 EnemySpawner

### 步骤1：创建刷怪点

1. 在 GameScene 中创建若干空物体，命名为 `SpawnPoint1`、`SpawnPoint2` 等
2. 将这些空物体放在场景的不同位置（例如玩家周围一圈）
3. 可以调整位置，让怪物从不同方向刷出来

### 步骤2：创建 EnemySpawner

1. 在 GameScene 中创建一个空物体，命名为 **EnemySpawner**
2. 添加组件：`Enemy Spawner`
3. 在 Inspector 中配置：
   - `Enemy Prefab`: 拖入刚才创建的 **Enemy** Prefab
   - `Spawn Points`: 点击 **Size**，设置为刷怪点数量，然后逐个拖入 `SpawnPoint1`、`SpawnPoint2` 等
   - `Spawn Interval`: **3**（每3秒生成一个）
   - `Max Alive Enemies`: **10**（最多同时存在10个敌人）
   - `Use Random Offset`: **勾选**（在刷怪点周围随机生成）
   - `Random Offset Radius`: **2**

### 步骤3：连接子弹 Prefab

1. 回到玩家对象，找到 `Player Combat Controller` 组件
2. 将 **Bullet** Prefab 拖到 `Bullet Prefab` 字段

---

## 六、测试

1. 运行游戏，进入 GameScene
2. 应该看到：
   - 每隔几秒，场景中会生成红色小球（怪物）
   - 怪物会自动朝玩家移动
   - 玩家会自动朝最近的怪物发射黄色子弹
   - 子弹命中怪物后，怪物会消失（死亡）
   - 如果怪物靠近玩家到一定距离，会停止移动

---

## 七、常见问题

### Q: 怪物不移动？
A: 检查：
- 玩家对象的 Tag 是否设置为 "Player"
- EnemyController 的 `Target` 字段是否为空（应该自动找到玩家）
- Console 是否有警告信息

### Q: 子弹不发射？
A: 检查：
- `PlayerCombatController` 的 `Bullet Prefab` 是否已设置
- `Fire Point` 是否已设置
- 场景中是否有敌人（`EnemyManager` 能找到敌人）
- `Attack Range` 是否足够大（敌人是否在范围内）

### Q: 子弹打不中怪物？/ 打中后子弹继续飞、敌人不扣血？
A: 检查：
- **子弹必须有 Rigidbody**（勾选 Is Kinematic），否则 `OnTriggerEnter` 不触发。
- 子弹的 Collider 勾选 **Is Trigger**；怪物 Collider 也勾选 **Is Trigger**（或至少一方 Trigger）。
- 怪物 Tag = **Enemy**，子弹 `Target Tag` = **Enemy**。
- 怪物有 **Health** 组件；Project Settings > Physics 中两方 Layer 可碰撞。

### Q: 怪物不死亡？
A: 检查：
- 怪物是否有 `Health` 组件
- 子弹的 `Damage` 是否大于 0
- 怪物的 `Max Health` 是否合理（如果血量太高，需要多发子弹才能打死）

---

## 八、后续扩展

当你需要添加更多功能时：

1. **怪物类型**：
   - 创建不同的怪物 Prefab（不同大小、颜色、血量）
   - 在 `EnemySpawner` 中配置多个 Prefab，随机生成

2. **武器系统**：
   - 创建 `WeaponConfig` ScriptableObject
   - `PlayerCombatController` 从配置读取伤害、射速等

3. **UI 显示**：
   - 在 `GameHudPanel` 中添加血条（调用 `Health.HealthPercent`）
   - 显示击杀数（监听 `Health.OnDeath` 事件）

4. **特效和音效**：
   - 在 `Health.OnDeath` 中播放死亡特效
   - 在 `Projectile` 命中时播放受击特效

---

完成以上步骤后，你应该能看到一个完整的"玩家移动 → 自动射击 → 怪物死亡"循环了！
