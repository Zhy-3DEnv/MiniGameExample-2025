# 运行时配置系统设置说明

## 功能说明

本系统允许你在**游戏运行时**修改角色伤害、怪物血量等参数，并自动保存到本地文件。下次启动游戏时会自动加载保存的配置，无需重新打包。

---

## 一、创建配置资源（ScriptableObject）

### 步骤1：创建 GameConfig 资源

1. 在 Project 窗口中，右键点击 `Assets/EggRogue/Config/` 文件夹（如果没有就创建）
2. 选择 **Create > EggRogue > Game Config**
3. 命名为 `GameConfig`
4. 在 Inspector 中设置**默认值**：
   - `Player Damage`: **10**（玩家单发伤害）
   - `Player Attack Range`: **10**（攻击范围）
   - `Player Fire Rate`: **2**（射速）
   - `Enemy Max Health`: **20**（怪物最大生命值）
   - `Enemy Move Speed`: **3**（怪物移动速度）
   - `Coin Drop Min`: **1**（最少掉落金币）
   - `Coin Drop Max`: **2**（最多掉落金币）

---

## 二、设置 ConfigManager

### 步骤1：创建 ConfigManager 对象

1. 在 **GameScene** 中创建一个空物体，命名为 **ConfigManager**
2. 添加组件：`Config Manager`
3. 在 Inspector 中：
   - `Default Config`: 拖入刚才创建的 **GameConfig** 资源
   - `Config File Name`: **gameconfig.json**（默认即可）

### 步骤2：确保 ConfigManager 持久化

- `ConfigManager` 会自动使用 `DontDestroyOnLoad`，跨场景保留
- 配置文件保存在 `Application.persistentDataPath/gameconfig.json`

---

## 三、创建调试配置面板（可选，但推荐）

### 步骤1：创建 UI 面板

1. 在 **Canvas** 下创建一个 **Panel**，命名为 `DebugConfigPanel`
2. 设置 Panel 大小和位置（例如居中，大小 400x500）
3. 添加组件：`Debug Config Panel`

### 步骤2：创建输入框和按钮

在 `DebugConfigPanel` 下创建以下 UI 元素：

#### 输入框（InputField）

1. **PlayerDamageInput**：
   - 添加 **Text** 子物体（显示标签："玩家伤害"）
   - 添加 **InputField** 组件

2. **EnemyHealthInput**：
   - 添加 **Text** 子物体（显示标签："怪物血量"）
   - 添加 **InputField** 组件

3. **PlayerAttackRangeInput**：
   - 添加 **Text** 子物体（显示标签："攻击范围"）
   - 添加 **InputField** 组件

4. **PlayerFireRateInput**：
   - 添加 **Text** 子物体（显示标签："射速"）
   - 添加 **InputField** 组件

5. **EnemyMoveSpeedInput**：
   - 添加 **Text** 子物体（显示标签："怪物移速"）
   - 添加 **InputField** 组件

6. **CoinDropMinInput**：
   - 添加 **Text** 子物体（显示标签："最少金币"）
   - 添加 **InputField** 组件

7. **CoinDropMaxInput**：
   - 添加 **Text** 子物体（显示标签："最多金币"）
   - 添加 **InputField** 组件

#### 按钮（Button）

1. **ApplyButton**：文本 "应用配置"
2. **ResetButton**：文本 "重置默认"
3. **CloseButton**：文本 "关闭"

### 步骤3：连接引用

1. 选中 `DebugConfigPanel` 对象
2. 在 `Debug Config Panel` 组件中，将所有 InputField 和 Button 拖到对应字段
3. 设置 `Toggle Key` = **F1**（按 F1 显示/隐藏面板）

### 步骤4：初始隐藏面板

1. 在 Hierarchy 中，取消勾选 `DebugConfigPanel`（默认隐藏）
2. 运行游戏后，按 **F1** 显示面板

---

## 四、使用方式

### 方式1：通过调试面板（推荐）

1. 运行游戏
2. 按 **F1** 打开调试面板
3. 修改参数（例如将"玩家伤害"改为 15）
4. 点击 **应用配置**
5. 配置会立即生效，并保存到本地文件
6. 下次启动游戏时会自动加载保存的配置

### 方式2：通过代码

```csharp
// 修改玩家伤害
ConfigManager.Instance.UpdateConfig(playerDamage: 15f);

// 修改怪物血量
ConfigManager.Instance.UpdateConfig(enemyMaxHealth: 30f);

// 同时修改多个参数
ConfigManager.Instance.UpdateConfig(
    playerDamage: 15f,
    enemyMaxHealth: 30f,
    playerFireRate: 3f
);
```

---

## 五、配置文件位置

### Windows/Mac/Linux
```
%USERPROFILE%/AppData/LocalLow/<CompanyName>/<ProductName>/gameconfig.json
```

### 微信小游戏
```
游戏数据目录/gameconfig.json
```

### 查看配置文件

配置文件是 JSON 格式，可以直接打开查看和编辑：

```json
{
    "playerDamage": 15.0,
    "playerAttackRange": 10.0,
    "playerFireRate": 2.0,
    "enemyMaxHealth": 30.0,
    "enemyMoveSpeed": 3.0,
    "coinDropMin": 1,
    "coinDropMax": 2
}
```

---

## 六、工作原理

1. **启动时**：
   - `ConfigManager` 从 ScriptableObject 加载默认配置
   - 如果本地有保存的配置文件，则覆盖默认值
   - 调用 `ApplyConfig()` 应用配置到游戏对象

2. **运行时修改**：
   - 通过调试面板或代码修改配置
   - 调用 `ApplyConfig()` 立即应用到游戏对象
   - 调用 `SaveConfig()` 保存到本地文件

3. **新生成的怪物**：
   - `EnemySpawner` 在生成怪物时，会从 `ConfigManager` 读取配置
   - 自动设置怪物的血量和移动速度

---

## 七、注意事项

1. **配置文件优先级**：
   - 本地保存的配置 > ScriptableObject 默认配置
   - 如果本地配置文件损坏或格式错误，会使用默认配置

2. **参数验证**：
   - 建议在调试面板中添加参数范围检查
   - 例如：伤害不能为负数，血量不能为 0

3. **性能**：
   - 配置修改会立即应用到所有已存在的对象
   - 对于大量怪物，可以考虑延迟应用或批量更新

4. **生产环境**：
   - 调试面板可以只在开发版本中启用
   - 使用 `#if UNITY_EDITOR || DEVELOPMENT_BUILD` 条件编译

---

## 八、扩展功能

### 添加新参数

1. 在 `GameConfig.cs` 中添加新字段
2. 在 `ConfigManager.UpdateConfig()` 中添加参数
3. 在 `DebugConfigPanel` 中添加对应的 InputField
4. 在需要的地方读取配置并应用

### 配置版本管理

如果需要支持配置版本升级，可以在 `GameConfig` 中添加 `version` 字段，在加载时检查版本并迁移旧配置。

---

完成以上设置后，你就可以在游戏运行时实时调整参数，无需重新打包了！
